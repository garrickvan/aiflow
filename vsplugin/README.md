# 智流MCP (AiFlow) - VSCode 插件

> 智流MCP，你的AI工作助手

智流MCP的VSCode配套插件，让你在编辑器内直接访问和管理智流后台服务。

## 功能特性

- **侧边栏集成** - 在VSCode左侧活动栏直接打开智流管理后台
- **灵活连接** - 支持自定义端口连接本地服务（默认9990）
- **多种查看模式** - 支持侧边栏嵌入、Tab标签页两种方式
- **智能检测** - 自动检测服务是否可用，连接失败友好提示
- **剪贴板支持** - 支持从智流后台复制内容到剪贴板


### MCP工具
智流MCP提供以下MCP工具供AI调用：

| 工具名 | 功能 |
|--------|------|
| `skill_get` | 查询技能列表（支持标签筛选和关键词搜索） |
| `skill_detail` | 查看技能详情 |
| `skill_save` | 保存/更新技能 |
| `job_new` | 创建新任务 |
| `job_get` | 查询任务详情 |
| `job_report` | 报告任务执行结果 |
| `job_redo` | 重新执行任务（新思路） |

### 支持范围

理论上所有支持MCP协议的AI都可以使用智流MCP，目前在Trae ID、Codebuddy插件中都测试通过。

### 模型接入使用方法

1. 先运行aiflow程序，确保MCP服务已启动
2. 确保AI Agent或IDE已连接到智流MCP服务
3. 调用MCP工具，例如：`skill_get`、`job_new`等
4. 浏览器打开http://localhost:9990/web，可管理skill，查看执行结果和任务状态

Agent使用时，配合rules文件，可实现自动处理任务。

### 规则文件

rules文件是一个YAML格式的文件，用于定义任务处理规则的上下文，大部分Agent和IDE都支持。例如：

```markdown
# 项目名：myproject

## 【执行前必做】

1. 检查任务编号：无则调用 `job_new`创建，有则提取
2. 无论任务大小，响应首行必须是任务状态声明
3. 判断是否需要 `job_report`

## 【规则正文】

1. 【任务识别】无"任务编号: JT-{项目名}-{日期}-{序号}"时调用 `job_new`创建，有则提取复用，但绝对不能编造任务编号
2. 【任务报告】代码修改完成/告知完成/任务失败时调用 `job_report`。测试/编译验收先执行再调用，人工验收可直接调用
3. 【验收选择】有测试脚本→测试验收；有编译命令→编译验收；其他→人工验收
4. 【任务重开】重新执行时先 `job_get`查看历史，再调整 `job_redo`
5. 【强制输出】响应首行声明状态：创建后输出"任务编号: JT-XXX"、执行中输出"任务: JT-XXX 执行中"、完成后输出"任务: JT-XXX 已归档"

## 【违规处理】

未遵守规则时立即停止，说明违规点，重新按正确流程执行
```

## 使用方法

### 1. 打开智流面板

点击VSCode左侧活动栏的**智流MCP**图标打开侧边栏面板。

### 2. 连接服务

1. 在侧边栏输入智流服务的端口号（默认：`9990`）
2. 点击「连接服务」按钮
3. 插件会自动检测服务是否可用

### 3. 查看管理后台

连接成功后，智流管理后台会嵌入显示在侧边栏中，你可以：

- **在侧边栏使用** - 直接操作管理后台
- **在Tab中打开** - 点击顶部「Tab」按钮，在代码编辑区打开
- **在浏览器打开** - 点击「浏览器」按钮，使用系统默认浏览器访问

### 4. 断开连接

点击顶部的「断开」按钮可返回端口输入页面，重新连接其他端口。

## 要求

- VSCode版本 >= 1.74.0
- 智流MCP服务已启动并监听相应端口

## 安装

### 从VSCode市场安装

在VSCode扩展商店搜索 "AiFlow" 或 "智流MCP" 并安装。

### 本地安装

```bash
# 克隆仓库
git clone https://github.com/garrick-g/aiflow.git

# 进入插件目录
cd aiflow/vsplugin

# 安装依赖
yarn install

# 编译
yarn compile

# 打包成vsix
npx vsce package

# 在VSCode中安装
# 按Ctrl+Shift+P，输入 "install from vsix"，选择生成的.vsix文件
```

## 命令列表

| 命令 | 命令ID | 说明 |
|------|--------|------|
| 在浏览器中打开 | `aiflow.openInBrowser` | 在系统浏览器中打开智流管理后台 |
| 刷新服务状态 | `aiflow.refreshServers` | 刷新服务连接状态 |

## 常见问题

### Q: 连接失败怎么办？

请检查：
1. 智流服务是否已启动（`go run cmd/api/main.go`）
2. 端口号是否正确（默认9990，可在启动参数中自定义）
3. 服务是否监听在localhost

### Q: 如何修改默认端口？

在侧边栏输入框中输入你的服务实际端口号即可。

### Q: 支持远程服务吗？

当前版本仅支持连接本地服务（localhost）。

## 发布日志

### 0.5.0

- 统一版本号到0.5.0
- 优化插件稳定性
- 支持剪贴板操作转发

### 0.0.1

- 初始版本发布
- 侧边栏WebView集成
- 支持自定义端口连接
- 支持Tab和浏览器打开

## 相关链接

- [智流MCP主项目](https://github.com/garrick-g/aiflow)
- [问题反馈](https://github.com/garrick-g/aiflow/issues)

## 许可证

[MIT](LICENSE)
